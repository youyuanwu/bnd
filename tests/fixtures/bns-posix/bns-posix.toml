include_paths = ["/usr/include/x86_64-linux-gnu", "/usr/include"]

[output]
name = "posix"
file = "bns-posix.winmd"

# Partition 1: shared POSIX types — uid_t, pid_t, mode_t, off_t, gid_t, etc.
# Must come first so the type registry claims these names (first-writer-wins)
# and the dedup pass removes duplicates from later partitions.
[[partition]]
namespace = "posix.types"
library = "c"
headers = ["sys/types.h"]
traverse = ["sys/types.h", "bits/types.h"]

# Partition 2: fcntl — creat + O_* flags
# open/openat/fcntl are variadic and will be auto-skipped
[[partition]]
namespace = "posix.fcntl"
library = "c"
headers = ["fcntl.h"]
traverse = ["fcntl.h", "bits/fcntl-linux.h"]

# Partition 3: unistd — read/write/close/lseek
[[partition]]
namespace = "posix.unistd"
library = "c"
headers = ["unistd.h"]
traverse = ["unistd.h"]

# Partition 4: sys/stat — struct stat + stat/fstat/chmod + S_* constants
[[partition]]
namespace = "posix.stat"
library = "c"
headers = ["sys/stat.h"]
traverse = ["sys/stat.h", "bits/struct_stat.h", "bits/types/struct_timespec.h"]

# Partition 5: sys/mman — mmap/munmap/mprotect + MAP_*/PROT_* constants
[[partition]]
namespace = "posix.mmap"
library = "c"
headers = ["sys/mman.h"]
traverse = ["sys/mman.h", "bits/mman-linux.h", "bits/mman-map-flags-generic.h"]

# Partition 6: dirent — opendir/readdir/closedir + struct dirent + DT_* constants
[[partition]]
namespace = "posix.dirent"
library = "c"
headers = ["dirent.h"]
traverse = ["dirent.h", "bits/dirent.h"]

# Partition 7: sys/socket — socket/bind/listen/accept + AF_*/SOCK_*/SO_* constants
[[partition]]
namespace = "posix.socket"
library = "c"
headers = ["sys/socket.h"]
traverse = [
    "sys/socket.h",
    "bits/socket.h",
    "bits/socket_type.h",
    "bits/socket-constants.h",
    "bits/types/struct_iovec.h",
]

# Partition 8: netinet/in + arpa/inet — sockaddr_in, in6_addr, inet_pton/ntop
[[partition]]
namespace = "posix.inet"
library = "c"
headers = ["netinet/in.h", "arpa/inet.h"]
traverse = ["netinet/in.h", "arpa/inet.h"]

# Partition 9: netdb — getaddrinfo/freeaddrinfo + struct addrinfo + AI_* constants
[[partition]]
namespace = "posix.netdb"
library = "c"
headers = ["netdb.h"]
traverse = ["netdb.h", "bits/netdb.h"]

# Partition 10: signal — signal/sigaction/kill/raise + struct sigaction + SIG*/SA_* constants
[[partition]]
namespace = "posix.signal"
library = "c"
headers = ["signal.h"]
traverse = [
    "signal.h",
    "bits/sigaction.h",
    "bits/signum-generic.h",
    "bits/signum-arch.h",
    "bits/sigcontext.h",
    "bits/types/__sigset_t.h",
    "bits/types/siginfo_t.h",
    "bits/types/__sigval_t.h",
    "bits/types/stack_t.h",
    "bits/types/struct_sigstack.h",
]

# Partition 11: dlfcn — dlopen/dlclose/dlsym/dlerror + RTLD_* constants + Dl_info struct
# On glibc 2.34+, dl* symbols live in libc (libdl.so.2 is a stub).
[[partition]]
namespace = "posix.dl"
library = "c"
headers = ["dlfcn.h"]
traverse = ["dlfcn.h", "bits/dlfcn.h"]

# Partition 12: errno — __errno_location() returns *mut i32, E* error constants
[[partition]]
namespace = "posix.errno"
library = "c"
headers = ["errno.h"]
traverse = [
    "errno.h",
    "bits/errno.h",
    "linux/errno.h",
    "asm/errno.h",
    "asm-generic/errno.h",
    "asm-generic/errno-base.h",
]

# Partition 13: sched — sched_yield/sched_setscheduler + SCHED_*/CLONE_* constants
# clone() is variadic and will be auto-skipped.
# On glibc 2.34+, sched_* symbols live in libc.
[[partition]]
namespace = "posix.sched"
library = "c"
headers = ["sched.h"]
traverse = [
    "sched.h",
    "bits/sched.h",
    "bits/types/struct_sched_param.h",
    "bits/cpu-set.h",
]

# Partition 14: time — clock_gettime/nanosleep/gmtime + CLOCK_* constants + struct tm
[[partition]]
namespace = "posix.time"
library = "c"
headers = ["time.h"]
traverse = [
    "time.h",
    "bits/time.h",
    "bits/types/clock_t.h",
    "bits/types/struct_tm.h",
    "bits/types/clockid_t.h",
    "bits/types/timer_t.h",
    "bits/types/struct_itimerspec.h",
    "bits/types/locale_t.h",
    "bits/types/__locale_t.h",
]

# Partition 15: pthread — pthread_create/join/mutex/cond/rwlock + PTHREAD_* constants
# pthread_create takes a function pointer param (delegate-as-param codegen path).
# On glibc 2.34+, pthread_* symbols live in libc.
[[partition]]
namespace = "posix.pthread"
library = "c"
headers = ["pthread.h"]
traverse = [
    "pthread.h",
    "bits/pthreadtypes.h",
    "bits/thread-shared-types.h",
    "bits/pthreadtypes-arch.h",
    "bits/atomic_wide_counter.h",
    "bits/struct_mutex.h",
    "bits/struct_rwlock.h",
    "bits/types/__sigset_t.h",
    "bits/types/struct___jmp_buf_tag.h",
    "bits/pthread_stack_min-dynamic.h",
    "bits/pthread_stack_min.h",
]
